<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secret Key - Talking History</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            width: 400px;
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
        }
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }
        .btn {
            width: 100%;
            padding: 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
        }
        .btn:hover {
            background-color: #45a049;
        }
        .error {
            color: red;
            text-align: center;
            margin-top: 10px;
            display: none;
        }
        .info {
            background-color: #e3f2fd;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            font-size: 13px;
            color: #1976d2;
            border-left: 4px solid #2196F3;
        }
        .warning {
            background-color: #fff3e0;
            padding: 15px;
            border-radius: 4px;
            margin-top: 20px;
            font-size: 12px;
            color: #e65100;
            border-left: 4px solid #ff9800;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Secret Key Required</h1>
        <p class="subtitle">Enter your secret key to encrypt your data</p>

        <div class="info">
            <strong>Important:</strong> This secret key is used to encrypt your data before storing it in the database. 
            Keep it safe! If you lose it, you won't be able to access your encrypted data.
        </div>

        <form onsubmit="saveSecretKey(event)">
            <div class="form-group">
                <label for="secretKey">Secret Key</label>
                <input type="password" id="secretKey" required 
                       placeholder="Enter your secret key" 
                       minlength="8"
                       autocomplete="off">
            </div>

            <div class="form-group">
                <label for="confirmKey">Confirm Secret Key</label>
                <input type="password" id="confirmKey" required 
                       placeholder="Re-enter your secret key"
                       minlength="8"
                       autocomplete="off">
            </div>

            <button type="submit" class="btn">Save Secret Key</button>
        </form>

        <div class="warning">
            ⚠️ Your secret key is stored only in your browser's local storage and never sent to the server. 
            Make sure to remember it or store it securely.
        </div>

        <div class="error" id="errorMsg"></div>
    </div>

    <script>
        const stage = '{{ stage }}';

        function saveSecretKey(event) {
            event.preventDefault();

            const secretKey = document.getElementById('secretKey').value;
            const confirmKey = document.getElementById('confirmKey').value;

            if (secretKey !== confirmKey) {
                showError('Secret keys do not match. Please try again.');
                return;
            }

            if (secretKey.length < 8) {
                showError('Secret key must be at least 8 characters long.');
                return;
            }

            // Store the secret key in localStorage
            localStorage.setItem('secretKey', secretKey);

            // Redirect to data page
            window.location.href = `/${stage}/data`;
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMsg');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }

        // Check if secret key already exists
        if (localStorage.getItem('secretKey')) {
            window.location.href = `/${stage}/data`;
        }
    </script>
</body>
</html>
